#!/bin/sh

FILE=$1
MUDRAW_OPT="-o /dev/stdout -F png"

INDEX=1 # page origin:1
PAGES=`mutool info "$FILE" | grep "^Pages:" | cut -d" " -f2`

tput civis
tput clear

while :; do
	echo "filename:$FILE page:$INDEX"
	mutool draw -o - -F png "$FILE" "$INDEX" | img2sixel 2>/dev/null

	read -s -n 1 KEY

	tput clear

	case "$KEY" in
	"j")
		INDEX=$((INDEX + 1));;
	"J")
		INDEX=$((INDEX + 10));;
	"k")
		INDEX=$((INDEX - 1));;
	"K")
		INDEX=$((INDEX - 10));;
	"g")
		INDEX=1;;
	"G")
		INDEX=$PAGES;;
	"q")
		tput cnorm
		exit 0;;
	esac

	if test "$INDEX" -lt "1"; then
		INDEX=$PAGES
	elif test "$INDEX" -gt "$PAGES"; then
		INDEX=1
	fi
done
