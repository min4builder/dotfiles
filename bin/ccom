#!/bin/sh

CC=${CC:-gcc}
CFLAGS=${CFLAGS:--g -Og -Wall -std=c11 -pedantic -Wno-unknown-pragmas}

while [ ! "${1##-*}" ]; do
	CFLAGS="$CFLAGS $1"
	shift
done

LIBS=$(for i; do
	"$CC" -E "$i" | grep '^# *pragma \+lib \+'
done | sed 's/^# *pragma \+lib \+\(\w*\) *$/-l\1/g')

echo "$CC" $CFLAGS -o "${1%.c}" "$@" $LIBS
"$CC" $CFLAGS -o "${1%.c}" "$@" $LIBS
